<div class="container">
    
    <div class="customer-info">
        <h3>Masukkan Nama Anda</h3>
        <input type="text" id="customer-name" placeholder="Contoh: Budi" required>
    </div>
    
    <div class="content-grid">
        
        <div id="menu-section">
            </div>
        
        <div id="sticky-sidebar">
            
            <div id="cart">
                <h2 class="desktop-only">üõí Keranjang Pesanan</h2>
                <ul id="cart-items" class="desktop-only"><li style="color: #999; text-align: center;">Keranjang kosong.</li></ul>
                
                <div id="mobile-summary">
                    <div id="mobile-summary-bar" onclick="openModal('cart-bottom-sheet')">
                        <div class="cart-summary">
                            <p id="mobile-cart-total-qty" style="margin: 0; font-weight: 700; color: white; font-size: 1.1em;">0 Item | Total: Rp0</p>
                            <p id="mobile-payment-status" style="margin: 0; font-size: 0.8em; color: #ffc107;">Belum dibayar</p>
                        </div>
                        <button class="btn-cart-view">Keranjang Saya</button>
                    </div>
                </div>
                
                <button id="checkout-btn" onclick="checkout()" disabled>Pesan</button>

                <div id="payment-section" class="desktop-only" style="margin-top:20px; text-align:center;">
                    <button id="pay-btn" onclick="openPaymentModal()" class="btn-primary" style="width: 90%; margin: 0 auto; display: block;">üí≥ Bayar Sekarang</button>
                    <p id="payment-status" style="color:#555; margin-top:10px;">Belum dibayar ‚ùå</p>
                </div>
            </div>
        </div>
        </div>
    </div>

  <footer>¬© 2025 Pantry ‚Äî Dibuat dengan ‚ù§Ô∏è</footer>

  <div id="cart-bottom-sheet-modal" class="bottom-sheet">
    <div class="bottom-sheet-content">
        <div class="bottom-sheet-header">
            <h3>Keranjang Saya</h3>
            <span class="close" onclick="closeModal('cart-bottom-sheet')">&times;</span>
        </div>
        <div class="bottom-sheet-body">
            <div style="margin-top: 10px;">
                <p style="font-size: 0.9em; color: #999;">Detail Pesanan Anda:</p>
            </div>

            <ul id="cart-modal-items" style="list-style: none; padding: 0;">
                </ul>
        </div>
        <div class="bottom-sheet-footer">
            <div id="cart-modal-total-display">
                </div>
            
            <button id="continue-checkout-btn" class="btn-continue-checkout" onclick="continueToPayment()" disabled>
                Lanjut Bayar
            </button>
        </div>
    </div>
  </div>
  <script>
    // ... (Semua kode JavaScript Anda) ...

    // --- FUNGSI BARU UNTUK BOTTOM SHEET MODAL ---
    function updateCartModal() {
        const modalListEl = document.getElementById('cart-modal-items');
        const totalDisplayEl = document.getElementById('cart-modal-total-display');
        const continueBtn = document.getElementById('continue-checkout-btn');
        modalListEl.innerHTML = '';
        let total = 0;
        
        const isPaymentSubmitted = currentPayment && (currentPayment.status === "pending" || currentPayment.status === "paid");
        const isDisabledAttr = isPaymentSubmitted ? 'disabled' : '';

        if (cart.length === 0) {
            modalListEl.innerHTML = '<li style="color:#999;text-align:center; padding: 20px;">Keranjang kosong.</li>';
            totalDisplayEl.innerHTML = '';
            continueBtn.disabled = true;
            continueBtn.textContent = 'Keranjang Kosong';
            return;
        }

        cart.forEach((item) => {
            const subtotal = item.price * item.qty;
            total += subtotal;
            const menu = menuData.find(m => m.name === item.name);
            const menuPrice = menu ? menu.price : 0; // Ambil harga asli

            modalListEl.innerHTML += `
                <li class="cart-modal-item">
                    <div class="cart-modal-item-name">${item.name}</div>
                    <div class="cart-modal-item-actions">
                        <button class="btn-qty" onclick="changeMenuQty('${item.name}', ${menuPrice}, -1)" ${isDisabledAttr}>-</button>
                        <div class="qty-display">${item.qty}</div>
                        <button class="btn-qty btn-plus" onclick="changeMenuQty('${item.name}', ${menuPrice}, 1)" ${isDisabledAttr}>+</button>
                    </div>
                    <div class="cart-modal-item-price">Rp${formatRupiah(subtotal)}</div>
                </li>
            `;
        });
        
        const totalRupiah = formatRupiah(total);
        totalDisplayEl.innerHTML = `<div class="cart-modal-total"><span>Total Tagihan</span> <span>Rp${totalRupiah}</span></div>`;
        
        // Atur status tombol Lanjut Bayar di modal
        if (isPaymentSubmitted) {
            if (currentPayment.status === "paid") {
                 continueBtn.disabled = false;
                 continueBtn.textContent = 'Pesan Sekarang';
            } else {
                 continueBtn.disabled = true;
                 continueBtn.textContent = 'Menunggu Verifikasi...';
            }
        } else {
             continueBtn.disabled = false;
             continueBtn.textContent = `Lanjut Bayar (Rp${totalRupiah})`;
        }
    }

    function continueToPayment() {
        closeModal('cart-bottom-sheet'); // Tutup modal keranjang
        const nameInput = document.getElementById('customer-name');
        const name = nameInput.value.trim();
        if (!name) return alert("Masukkan nama Anda terlebih dahulu (input di bagian atas halaman).");
        
        if (currentPayment && currentPayment.status === "paid") {
             // Jika sudah dibayar, tombol di modal mobile berfungsi sebagai checkout
             checkout(); 
        } else {
            // Jika belum dibayar, panggil openPaymentModal()
            openPaymentModal();
        }
    }

    // --- MODIFIKASI FUNGSI YANG SUDAH ADA ---
    
    function changeMenuQty(name, price, delta) {
      if (currentPayment && (currentPayment.status === "pending" || currentPayment.status === "paid")) {
          alert("‚ùå Keranjang dikunci. Anda tidak dapat mengubah keranjang setelah mengajukan pembayaran.");
          return;
      }
      
      const exist = cart.find(i => i.name === name);
      if (exist) {
        exist.qty += delta;
        if (exist.qty <= 0) cart = cart.filter(i => i.name !== name);
      } else if (delta > 0) cart.push({ name, price, qty: 1 });
      
      updateCart();
      renderMenu(); 
      updateCartModal(); // Panggil untuk update modal
    }
    
    function updateCart() {
      const listEl = document.getElementById('cart-items');
      const checkoutBtn = document.getElementById('checkout-btn');
      const payBtn = document.getElementById('pay-btn'); 
      listEl.innerHTML = '';
      let total = 0;
      let totalQty = 0; // Hitung total Qty
      
      // --- LOGIC PERHITUNGAN DAN LIST DESKTOP ---
      if (cart.length === 0) {
        // ... (kode keranjang kosong) ...
      } else {
         payBtn.disabled = false;
        cart.forEach((item) => {
          const subtotal = item.price * item.qty;
          total += subtotal;
          totalQty += item.qty; // Tambahkan ke total quantity
          // ... (list desktop) ...
          listEl.innerHTML += `<li class="desktop-only">${item.name} - Rp${formatRupiah(subtotal)} (${item.qty}x)</li>`;
        });
      }

      // ... (kode total rupiah & payment status desktop) ...

      // --- LOGIC RESPONSIVE & MOBILE BAR ---
      // ... (deklarasi variabel mobile) ...
      const mobileCartTotalQty = document.getElementById('mobile-cart-total-qty');

      if (total > 0) {
          if (isMobile) {
              stickySidebar.classList.add('show-mobile'); 
              // Update total & qty di bottom bar
              mobileCartTotalQty.textContent = `${totalQty} Item | Total: Rp${totalRupiah}`;
              
              // Sembunyikan checkout-btn desktop di mobile
              checkoutBtn.style.display = 'none';

          } else {
              stickySidebar.classList.remove('show-mobile'); 
               // ... (Logika desktop) ...
          }
      } else {
          // Keranjang kosong
          if (isMobile) {
              stickySidebar.classList.remove('show-mobile'); 
          }
          checkoutBtn.textContent = `Pesan`;
          checkoutBtn.onclick = checkout;
          checkoutBtn.disabled = true;
      }
      
      // ... (Update Status Payment) ...
      
      // Panggil update modal
      updateCartModal();
    }
    
    // ... (openPaymentModal, selectPaymentMethod, checkPaymentStatus, checkout) ...


    // --- MODIFIKASI FUNGSI MODAL UNTUK ANIMASI BOTTOM SHEET ---
    
    function openModal(t) { 
        if(t === 'cart-bottom-sheet') {
            document.getElementById(t + "-modal").style.display = "block"; 
            setTimeout(() => { // Tambahkan class 'open' setelah display block untuk trigger animasi
                document.getElementById(t + "-modal").classList.add('open');
            }, 10);
        } else {
            document.getElementById(t + "-modal").style.display = "block"; 
        }
    }

    function closeModal(t) { 
        if(t === 'cart-bottom-sheet') {
            document.getElementById(t + "-modal").classList.remove('open');
            setTimeout(() => { // Sembunyikan setelah animasi selesai (300ms sesuai CSS transition)
                document.getElementById(t + "-modal").style.display = "none";
            }, 300);
        } else {
            document.getElementById(t + "-modal").style.display = "none"; 
        }
    }

    window.onclick = e => { 
        if (e.target.classList.contains('modal')) e.target.style.display = "none"; 
        if (e.target.classList.contains('bottom-sheet')) closeModal('cart-bottom-sheet'); // Tutup bottom sheet
    };
  </script>
</body>
</html>
