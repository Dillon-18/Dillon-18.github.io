<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantry - Pemesanan Online</title>
  <link rel="stylesheet" href="index.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="navbar">
    <div class="nav-left">
      <span class="brand-name">Pantry</span>
      <img src="Pantry Primary Logo-01.png" alt="Pantry Logo" class="brand-logo"> 
    </div>
    <div class="nav-right">
      <button class="nav-btn btn-secondary" onclick="openModal('contact')">Contact Me</button>
      <button class="nav-btn btn-secondary" onclick="openModal('info')">Info</button>
      <button class="nav-btn btn-primary" onclick="redirectToCashier()">Dashboard Kasir</button>
    </div>
  </header>
  
  <div class="container">
    <div class="content-grid">
        
        <div id="menu-section">
            <h2>Menu Makanan</h2>
            <div class="menu-list" id="menu-makanan"></div>

            <h2 style="margin-top: 30px;">Menu Minuman</h2>
            <div class="menu-list" id="menu-minuman"></div>
        </div>
        
        <div id="sticky-sidebar">
            
            <div class="customer-info">
                <h3>Detail Pelanggan</h3>
                <input type="text" id="customer-name" placeholder="Contoh: Budi (Masukan Nama Anda)" required>
            </div>

            <div id="cart">
                <h2 class="desktop-only">üõí Keranjang Pesanan</h2>
                <ul id="cart-items" class="desktop-only"><li style="color: #999; text-align: center;">Keranjang kosong.</li></ul>
                
                <div id="mobile-summary">
                    <div id="mobile-summary-bar" onclick="openModal('cart-bottom-sheet')">
                        <div class="cart-summary">
                            <p id="mobile-cart-total-qty" style="margin: 0;">0 Item | Total: Rp0</p>
                            <p id="mobile-payment-status" style="margin: 0; font-size: 0.8em; color: #ffc107;">Belum dibayar</p>
                        </div>
                        <button class="btn-cart-view">Keranjang Saya</button>
                    </div>
                </div>
                
                <button id="checkout-btn" onclick="checkout()" disabled>Pesan</button>

                <div id="payment-section" class="desktop-only" style="margin-top:20px; text-align:center;">
                    <button id="pay-btn" onclick="openPaymentModal()" class="btn-primary" style="width: 90%; margin: 0 auto; display: block;">üí≥ Bayar Sekarang</button>
                    <p id="payment-status" style="color:#555; margin-top:10px;">Belum dibayar ‚ùå</p>
                </div>
            </div>
        </div>
        </div>
    </div>

  <footer>¬© 2025 Pantry ‚Äî Dibuat dengan ‚ù§Ô∏è</footer>

  <div id="cart-bottom-sheet-modal" class="bottom-sheet">
    <div class="bottom-sheet-content">
        <div class="bottom-sheet-header">
            <h3>Keranjang Saya</h3>
            <span class="close" onclick="closeModal('cart-bottom-sheet')">&times;</span>
        </div>
        <div class="bottom-sheet-body">
            <div style="margin-top: 10px;">
                <p style="font-size: 0.9em; color: #999;">Blue Tent Canteen, Jakarta</p>
            </div>

            <ul id="cart-modal-items" style="list-style: none; padding: 0;">
                </ul>
        </div>
        <div class="bottom-sheet-footer">
            <div id="cart-modal-total-display">
                </div>
            
            <button id="continue-checkout-btn" class="btn-continue-checkout" onclick="continueToPayment()" disabled>
                Lanjut Bayar
            </button>
        </div>
    </div>
  </div>
  <div id="info-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('info')">&times;</span>
      <h2>Tentang Pantry</h2>
      <p>Pantry menyediakan makanan dan minuman lezat. Sekarang kamu bisa pesan online dan bayar lewat QR!</p>
    </div>
  </div>

  <div id="contact-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('contact')">&times;</span>
      <h2>Hubungi Kami</h2>
      <p>üìû <a href="tel:+6287777796610" class="contact-link">+62 877-7779-6610</a></p>
      <p>üí¨ <a href="https://wa.me/6287777796610" target="_blank" class="contact-link">Chat via WhatsApp</a></p>
      <p>üìß <a href="mailto:pantry@gmail.com" class="contact-link">pantry@gmail.com</a></p>
    </div>
  </div>

  <div id="payment-modal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <span class="close" onclick="closeModal('payment')">&times;</span>
      <h2>Pilih Metode Pembayaran</h2>
      <p style="margin-bottom: 20px;">Total Pesanan: <b id="payment-total-display" style="color: #ff6347;"></b></p>
      
      <div id="payment-options" style="display: flex; flex-direction: column; gap: 10px; max-width: 300px; margin: 0 auto;">
          </div>
      
      <p id="payment-note" style="margin-top: 30px;">Tunggu kasir memverifikasi pembayaranmu setelah kamu transfer.</p>
    </div>
  </div>

  <div id="payment-detail-modal" class="modal">
    <div class="modal-content" style="text-align:center;">
      <span class="close" onclick="closeModal('payment-detail')">&times;</span>
      <h2>Detail Pembayaran</h2>
      
      <p style="font-size: 1.1em; color: #ff6347; font-weight: 600;">Metode Pembayaran:</p>
      <div style="display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 20px;">
          <img id="payment-method-img" src="" alt="Metode Pembayaran" style="width: 50px; height: 50px; border-radius: 5px;">
          <p id="payment-method-name" style="font-size: 1.5em; font-weight: 700; color: #333; margin: 0;"></p>
      </div>

      <p style="font-size: 1.1em; color: #555;">Total yang Harus Dibayar:</p>
      <p id="payment-detail-total" style="font-size: 2em; font-weight: 700; color: #068b18; margin-top: 5px; margin-bottom: 20px;">Rp0</p>
      
      <p style="font-size: 1.1em; color: #555;">Kode Pembayaran Anda (Simpan):</p>
      <p id="payment-detail-code" style="font-size: 1.2em; font-weight: 700; color: #ff6347; margin-top: 5px; margin-bottom: 30px; padding: 10px; border: 1px dashed #ff6347; display: inline-block;">PAY0000</p>
      
      <p id="payment-detail-note" style="margin-top: 20px; color: #555;">
          **TIPS:** Silakan lakukan transfer/pembayaran di aplikasi terkait.
          <br>Kasir akan memverifikasi status pembayaran Anda setiap 2 detik.
      </p>

      <button onclick="closeModal('payment-detail')" class="btn-primary nav-btn" style="width: 100%; margin-top: 20px;">Kembali ke Menu</button>
    </div>
  </div>
  
  <script>
    const menuData = [
      { name: 'Nasi Goreng Spesial', price: 25000, category: 'makanan', img: 'nasgor.jpg' },
      { name: 'Mie Ayam Bakso', price: 20000, category: 'makanan', img: 'yamyam.jpg' },
      { name: 'Sate Ayam Madura', price: 30000, category: 'makanan', img: 'sate.jpg' },
      { name: 'Ayam Geprek Sambal Matah', price: 28000, category: 'makanan', img: 'ayamgeprek.jpg' },
      { name: 'Kwetiau Goreng Seafood', price: 27000, category: 'makanan', img: 'kwetiau.jpg' },
      { name: 'Soto Ayam Bening', price: 22000, category: 'makanan', img: 'soto.jpg' },
      { name: 'Beef Black Pepper', price: 35000, category: 'makanan', img: 'beefpepper.jpg' },
      { name: 'Capcay Kuah Sayur', price: 24000, category: 'makanan', img: 'capcay.jpg' },
      
      { name: 'Es Teh Manis', price: 8000, category: 'minuman', img: 'eses.jpg' },
      { name: 'Jus Alpukat', price: 15000, category: 'minuman', img: 'aalal.jpg' },
      { name: 'Kopi Susu Dingin', price: 12000, category: 'minuman', img: 'kopi.jpg' },
      { name: 'Teh Tarik Panas', price: 10000, category: 'minuman', img: 'tehtarik.jpg' },
      { name: 'Lemon Tea Dingin', price: 14000, category: 'minuman', img: 'lemontea.jpg' },
      { name: 'Milkshake Cokelat', price: 18000, category: 'minuman', img: 'milkshake.jpg' },
      { name: 'Air Mineral Botol', price: 5000, category: 'minuman', img: 'airmineral.jpg' },
      { name: 'Jus Mangga Segar', price: 16000, category: 'minuman', img: 'jusmangga.jpg' },
    ];

    const paymentMethods = [
      { name: 'GoPay', img: 'gopay.png', color: '#00A389', info: 'Scan kode QRIS di konter kasir. Pastikan nama Merchant: PANTRY.' },
      { name: 'ShopeePay', img: 'shopeepay.png', color: '#FF5733', info: 'Scan kode QRIS di konter kasir. Pastikan nama Merchant: PANTRY.' },
      { name: 'Dana', img: 'dana.png', color: '#1B72E5', info: 'Transfer ke Virtual Account Dana: 8528XXXXXXXXX (nomor HP Anda).' },
      { name: 'Bank Transfer (BCA)', img: 'bca.png', color: '#004A99', info: 'Transfer ke Rekening BCA: 1234567890 a.n. Pantry.' },
      { name: 'QR All-Wallet', img: 'qris.png', color: '#004A99', info: 'Scan QRIS berikut. Pastikan nama Merchant: PANTRY.' }, 
      { name: 'Tunai (Cash)', img: 'cash.png', color: '#d14838', info: 'Bayar Tunai langsung ke kasir. Kasir akan memverifikasi di tempat.' }
    ];

    let cart = [];
    let currentPayment = null; 

    document.addEventListener('DOMContentLoaded', () => {
      const lastPaymentId = localStorage.getItem('lastPaymentId');
      if (lastPaymentId) {
          const payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
          const lastPayment = payments.find(p => p.id === lastPaymentId);
          if (lastPayment) {
              currentPayment = lastPayment;
              if (currentPayment.cart) {
                  cart = currentPayment.cart;
                  document.getElementById('customer-name').value = currentPayment.customerName || '';
              }
          } else {
              localStorage.removeItem('lastPaymentId');
          }
      }
      
      renderMenu();
      updateCart();
      setInterval(checkPaymentStatus, 2000); 
    });

    function redirectToCashier() {
      const pass = prompt("Masukkan password kasir:");
      if (pass === "kasir123") {
        sessionStorage.setItem("cashierAuth", "true");
        window.location.href = "cashier.html";
      } else if (pass) alert("Password salah!");
    }

    function formatRupiah(number) {
        return number.toLocaleString('id-ID');
    }

    function renderMenu() {
      const makananEl = document.getElementById('menu-makanan');
      const minumanEl = document.getElementById('menu-minuman');
      makananEl.innerHTML = '';
      minumanEl.innerHTML = '';
      
      const isPaymentSubmitted = currentPayment && (currentPayment.status === "pending" || currentPayment.status === "paid");
      const isDisabledAttr = isPaymentSubmitted ? 'disabled' : '';

      menuData.forEach(item => {
        const exist = cart.find(i => i.name === item.name);
        const qty = exist ? exist.qty : 0;

        const div = document.createElement('div');
        div.className = 'menu-item';
        div.innerHTML = `
          <img src="${item.img}" alt="${item.name}">
          <div class="menu-info">
            <div class="menu-name">${item.name}</div>
            <div class="menu-price">Rp${formatRupiah(item.price)}</div>
          </div>
          <div class="menu-actions">
            <button class="btn-qty" onclick="changeMenuQty('${item.name}', ${item.price}, -1)" ${isDisabledAttr}>-</button>
            <div class="qty-display">${qty}</div>
            <button class="btn-qty btn-plus" onclick="changeMenuQty('${item.name}', ${item.price}, 1)" ${isDisabledAttr}>+</button>
          </div>`;
        if (item.category === 'makanan') makananEl.appendChild(div);
        else minumanEl.appendChild(div);
      });
    }
    
    // Fungsi untuk memperbarui jumlah item di cart-modal
    function updateCartModal() {
        const modalListEl = document.getElementById('cart-modal-items');
        const totalDisplayEl = document.getElementById('cart-modal-total-display');
        const continueBtn = document.getElementById('continue-checkout-btn');
        modalListEl.innerHTML = '';
        let total = 0;
        
        const isPaymentSubmitted = currentPayment && (currentPayment.status === "pending" || currentPayment.status === "paid");
        const isDisabledAttr = isPaymentSubmitted ? 'disabled' : '';

        if (cart.length === 0) {
            modalListEl.innerHTML = '<li style="color:#999;text-align:center; padding: 20px;">Keranjang kosong.</li>';
            totalDisplayEl.innerHTML = '';
            continueBtn.disabled = true;
            continueBtn.textContent = 'Keranjang Kosong';
            return;
        }

        cart.forEach((item) => {
            const subtotal = item.price * item.qty;
            total += subtotal;
            const menu = menuData.find(m => m.name === item.name);
            const menuPrice = menu ? menu.price : 0; // Ambil harga asli

            modalListEl.innerHTML += `
                <li class="cart-modal-item">
                    <div class="cart-modal-item-name">${item.name}</div>
                    <div class="cart-modal-item-actions">
                        <button class="btn-qty" onclick="changeMenuQty('${item.name}', ${menuPrice}, -1)" ${isDisabledAttr}>-</button>
                        <div class="qty-display">${item.qty}</div>
                        <button class="btn-qty btn-plus" onclick="changeMenuQty('${item.name}', ${menuPrice}, 1)" ${isDisabledAttr}>+</button>
                    </div>
                    <div class="cart-modal-item-price">Rp${formatRupiah(subtotal)}</div>
                </li>
            `;
        });
        
        const totalRupiah = formatRupiah(total);
        totalDisplayEl.innerHTML = `<div class="cart-modal-total"><span>Total price</span> <span>Rp${totalRupiah}</span></div>`;
        
        // Atur status tombol Lanjut Bayar di modal
        if (isPaymentSubmitted) {
            continueBtn.disabled = true;
            continueBtn.textContent = (currentPayment.status === "pending") ? 'Menunggu Verifikasi...' : 'Pesan Sekarang';
             if (currentPayment.status === "paid") {
                 continueBtn.disabled = false;
             }
        } else {
             continueBtn.disabled = false;
             continueBtn.textContent = `Lanjut Bayar (Rp${totalRupiah})`;
        }
    }


    function changeMenuQty(name, price, delta) {
      if (currentPayment && (currentPayment.status === "pending" || currentPayment.status === "paid")) {
          alert("‚ùå Keranjang dikunci. Anda tidak dapat mengubah keranjang setelah mengajukan pembayaran.");
          return;
      }
      
      const exist = cart.find(i => i.name === name);
      if (exist) {
        exist.qty += delta;
        if (exist.qty <= 0) cart = cart.filter(i => i.name !== name);
      } else if (delta > 0) cart.push({ name, price, qty: 1 });
      updateCart();
      renderMenu(); 
      updateCartModal(); // Perbarui modal keranjang
    }

    function updateCart() {
      const listEl = document.getElementById('cart-items');
      const checkoutBtn = document.getElementById('checkout-btn');
      const payBtn = document.getElementById('pay-btn'); 
      listEl.innerHTML = '';
      let total = 0;
      let totalQty = 0;

      // --- LOGIC PERHITUNGAN DAN LIST DESKTOP ---
      if (cart.length === 0) {
        listEl.innerHTML = '<li style="color:#999;text-align:center;">Keranjang kosong.</li>';
        payBtn.disabled = true;
      } else {
         payBtn.disabled = false;
        cart.forEach((item) => {
          const subtotal = item.price * item.qty;
          total += subtotal;
          totalQty += item.qty;
          // Tambahkan class desktop-only ke list item
          listEl.innerHTML += `<li class="desktop-only">${item.name} - Rp${formatRupiah(subtotal)} (${item.qty}x)</li>`;
        });
      }

      const totalRupiah = formatRupiah(total);
      // Tambahkan total di keranjang (desktop)
      if (total > 0) {
        listEl.innerHTML += `<li class="cart-total desktop-only" style="font-weight: 700; border-top: 1px solid #ddd; margin-top: 10px;"><span>TOTAL:</span> <b>Rp${totalRupiah}</b></li>`;
      }

      const isPaid = currentPayment && currentPayment.status === "paid";
      const isPending = currentPayment && currentPayment.status === "pending";
      const paymentStatusEl = document.getElementById('payment-status');


      // --- LOGIC RESPONSIVE & MOBILE BAR ---
      // Cek apakah perangkat adalah mobile (max-width: 768px sesuai CSS)
      const isMobile = window.matchMedia('(max-width: 768px)').matches;
      const stickySidebar = document.getElementById('sticky-sidebar');
      const mobileCartTotalQty = document.getElementById('mobile-cart-total-qty');
      const mobilePaymentStatus = document.getElementById('mobile-payment-status');
      const nameInput = document.getElementById('customer-name');


      if (total > 0) {
          if (isMobile) {
              stickySidebar.classList.add('show-mobile'); // Tampilkan bar bawah jika ada item
              mobileCartTotalQty.textContent = `${totalQty} Item | Total: Rp${totalRupiah}`;
          } else {
              stickySidebar.classList.remove('show-mobile'); // Pastikan hilang di desktop
               // Logika desktop untuk tombol checkoutBtn.textContent
              checkoutBtn.textContent = (total === 0) ? `Pesan` : `Pesan - Rp${totalRupiah}`;
              checkoutBtn.onclick = checkout; // Kembalikan fungsi checkout normal
              checkoutBtn.disabled = !isPaid; // Logic disabled desktop
          }
      } else {
          // Keranjang kosong
          if (isMobile) {
              stickySidebar.classList.remove('show-mobile'); // Sembunyikan bar
          }
          checkoutBtn.textContent = `Pesan`;
          checkoutBtn.onclick = checkout;
          checkoutBtn.disabled = true;
      }
      
      // --- Update Status Payment ---
      if (isPaid) {
          mobilePaymentStatus.textContent = "Sudah bayar ‚úÖ";
          paymentStatusEl.textContent = `Sudah diverifikasi (${currentPayment.method}) ‚úÖ`;
      } else if (isPending) {
          mobilePaymentStatus.textContent = "Menunggu verifikasi ‚è≥";
          paymentStatusEl.textContent = "Menunggu verifikasi kasir ‚è≥";
      } else {
          mobilePaymentStatus.textContent = "Belum dibayar ‚ùå";
          paymentStatusEl.textContent = "Belum dibayar ‚ùå";
      }

      // Kelola tombol Bayar (payBtn) hanya di tampilan DESKTOP
      if (isPending) {
          payBtn.textContent = "‚è≥ Pembayaran Tertunda";
          payBtn.disabled = true;
      } else if (isPaid) {
          payBtn.textContent = "‚úÖ Pembayaran Diterima";
          payBtn.disabled = true;
      } else {
          payBtn.textContent = "üí≥ Bayar Sekarang";
          payBtn.disabled = (total === 0);
      }
      
      updateCartModal(); // Panggil ini juga untuk memastikan modal up-to-date
    }

    // Fungsi baru untuk Lanjut Bayar di modal mobile
    function continueToPayment() {
        if (currentPayment && currentPayment.status === "paid") {
             // Jika sudah dibayar, tombol Lanjut Bayar di modal mobile berfungsi sebagai checkout
             checkout(); 
        } else {
            // Jika belum dibayar, panggil openPaymentModal()
            openPaymentModal();
        }
    }


    function openPaymentModal() {
      const nameInput = document.getElementById('customer-name');
      const name = nameInput.value.trim();
      if (!name) return alert("‚ùå Masukkan nama Anda terlebih dahulu (input di bagian atas halaman)."); 

      if (cart.length === 0) return alert("Keranjang kosong!");
      if (currentPayment && (currentPayment.status === "pending" || currentPayment.status === "paid")) {
        closeModal('cart-bottom-sheet'); // Tutup modal keranjang jika terbuka
        if(currentPayment.status === "pending") return alert("Anda sudah memiliki pembayaran tertunda. Harap tunggu verifikasi kasir.");
        if(currentPayment.status === "paid") return alert("Pembayaran sudah diverifikasi. Silakan tekan tombol 'Pesan' di modal Keranjang Saya.");
      }
      
      closeModal('cart-bottom-sheet'); // Tutup modal keranjang jika dipanggil dari mobile

      const total = cart.reduce((s, i) => s + i.price * i.qty, 0);
      document.getElementById('payment-total-display').textContent = 'Rp' + formatRupiah(total);
      
      const optionsEl = document.getElementById('payment-options');
      optionsEl.innerHTML = '';
      
      paymentMethods.forEach(method => {
          const btn = document.createElement('button');
          btn.textContent = `Bayar dengan ${method.name}`;
          btn.style.cssText = `
              background-color: ${method.color}; color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: opacity 0.2s, transform 0.2s;
          `;
          btn.onmouseover = () => { btn.style.opacity = '0.9'; btn.style.transform = 'translateY(-1px)'; };
          btn.onmouseout = () => { btn.style.opacity = '1'; btn.style.transform = 'translateY(0)'; };
          btn.onclick = () => selectPaymentMethod(method.name, total);
          optionsEl.appendChild(btn);
      });
      
      document.getElementById('payment-note').textContent = "Semua metode memerlukan verifikasi kasir. Untuk Tunai: serahkan uang ke kasir. Untuk Transfer/E-Wallet: lakukan transfer dan tunggu kasir memverifikasi.";

      document.getElementById('payment-modal').style.display = 'block';
    }

    function selectPaymentMethod(methodName, total) {
      closeModal('payment');
      
      const code = "PAY" + Date.now().toString().slice(-6); 
      const customerName = document.getElementById('customer-name').value.trim();
      
      const selectedMethod = paymentMethods.find(m => m.name === methodName);
      const instruction = selectedMethod.info; 
      
      const status = (methodName === 'Tunai (Cash)') ? 'paid' : 'pending';
      
      const newPayment = { 
          id: code, 
          status: status,
          total, 
          cart: JSON.parse(JSON.stringify(cart)), 
          time: new Date().toLocaleString('id-ID'),
          method: methodName,
          customerName: customerName 
      };

      currentPayment = newPayment;
      localStorage.setItem('lastPaymentId', code); 
      
      let payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
      payments = payments.filter(p => p.id !== code); 
      payments.push(newPayment);
      localStorage.setItem('pantryPayments', JSON.stringify(payments));

      // Tampilkan Modal Detail Pembayaran (dari index.html)
      document.getElementById('payment-method-img').src = selectedMethod.img || '';
      document.getElementById('payment-method-name').textContent = selectedMethod.name;
      document.getElementById('payment-detail-total').textContent = 'Rp' + formatRupiah(total);
      document.getElementById('payment-detail-code').textContent = code;
      
      document.getElementById('payment-detail-note').innerHTML = instruction;

      openModal('payment-detail');
      
      checkPaymentStatus(); 
      renderMenu(); 
    }

    function checkPaymentStatus() {
      const paymentStatusEl = document.getElementById('payment-status');
      
      if (!currentPayment) {
        paymentStatusEl.textContent = "Belum dibayar ‚ùå";
        return;
      }
      
      const payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
      const found = payments.find(p => p.id === currentPayment.id);
      
      if (!found) {
        if (currentPayment.status === "paid" && cart.length === 0) {
             // Reset setelah checkout berhasil
            currentPayment = null;
            localStorage.removeItem('lastPaymentId'); 
            document.getElementById('customer-name').value = ''; 
            updateCart();
            renderMenu(); 
            paymentStatusEl.textContent = "Pesanan selesai. Silakan pesan lagi!";
            return;
        }
      }
      
      if (found && found.status === "paid") {
        const statusChanged = currentPayment.status !== "paid";
        currentPayment.status = "paid"; 
        
        if(statusChanged && found.method !== 'Tunai (Cash)') {
            alert(`‚úÖ Pembayaran Diverifikasi oleh Kasir! Anda sekarang bisa menekan tombol "Keranjang Saya" dan "Pesan Sekarang" untuk mengirim order ke dapur.`);
            closeModal('payment-detail'); // Tutup modal detail jika verifikasi berhasil
        }
        
        paymentStatusEl.textContent = `Sudah diverifikasi (${found.method}) ‚úÖ`;
      } else {
        // Jika statusnya pending atau tidak ditemukan (tapi currentPayment ada), anggap pending
        if(currentPayment.status !== "paid") {
             currentPayment.status = "pending";
        }
        paymentStatusEl.textContent = "Menunggu verifikasi kasir ‚è≥";
      }
      
      updateCart(); 
    }

    function checkout() {
      if (!currentPayment || currentPayment.status !== "paid") {
          return alert("‚ùå Pembayaran belum diverifikasi oleh kasir!");
      }

      const nameInput = document.getElementById('customer-name');
      const name = nameInput.value.trim();
      if (!name) return alert("Masukkan nama Anda!");

      closeModal('cart-bottom-sheet'); // Tutup modal keranjang

      const finalCart = currentPayment.cart; 
      
      const newOrderId = Date.now(); 
      const order = {
        id: newOrderId,
        customerName: name, 
        items: finalCart, 
        total: currentPayment.total, 
        status: 'Baru', 
        time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
        paymentId: currentPayment.id,
        method: currentPayment.method // Tambahkan metode pembayaran
      };

      const orders = JSON.parse(localStorage.getItem('pantryOrders')) || [];
      orders.unshift(order);
      localStorage.setItem('pantryOrders', JSON.stringify(orders)); 

      let payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
      payments = payments.filter(p => p.id !== currentPayment.id);
      localStorage.setItem('pantryPayments', JSON.stringify(payments));

      alert(`‚úÖ Pesanan ${name} berhasil dibuat! Pesanan akan segera diproses.`);
      
      // Karena file order_status.html tidak tersedia, kita hanya akan me-refresh halaman 
      // dan mereset status setelah order selesai dibuat.
      
      // Hapus data pembayaran yang baru saja di-checkout
      currentPayment = null;
      localStorage.removeItem('lastPaymentId'); 
      cart = [];
      document.getElementById('customer-name').value = ''; 
      
      updateCart();
      renderMenu(); 
    }

    function openModal(t) { 
        if(t === 'cart-bottom-sheet') {
            document.getElementById(t + "-modal").style.display = "block"; 
            setTimeout(() => { // Tambahkan class 'open' setelah display block untuk trigger animasi
                document.getElementById(t + "-modal").classList.add('open');
            }, 10);
        } else {
            document.getElementById(t + "-modal").style.display = "block"; 
        }
    }
    
    function closeModal(t) { 
        if(t === 'cart-bottom-sheet') {
            document.getElementById(t + "-modal").classList.remove('open');
            setTimeout(() => { // Sembunyikan setelah animasi selesai
                document.getElementById(t + "-modal").style.display = "none";
            }, 300);
        } else {
            document.getElementById(t + "-modal").style.display = "none"; 
        }
    }
    
    window.onclick = e => { 
        if (e.target.classList.contains('modal')) e.target.style.display = "none"; 
        if (e.target.classList.contains('bottom-sheet')) closeModal('cart-bottom-sheet'); // Tutup bottom sheet
    };
  </script>
</body>
</html>
