<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantry - Status Pesanan</title>
  <link rel="stylesheet" href="index.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* CSS Khusus Status Pesanan */
    .container {
      max-width: 800px;
      margin-top: 50px;
    }
    
    h1 {
        color: #ff6347;
        text-align: center;
        margin-bottom: 30px;
    }

    /* === Status Stepper === */
    .status-stepper {
        display: flex;
        justify-content: space-between;
        margin: 30px 0 60px 0;
        position: relative;
    }

    .stepper-line {
        position: absolute;
        top: 15px;
        left: 5%;
        width: 90%;
        height: 4px;
        background-color: #ddd;
        z-index: 1;
    }

    .stepper-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 30%;
        position: relative;
        z-index: 2;
    }

    .stepper-circle {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        background-color: #ddd;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        margin-bottom: 10px;
        transition: background-color 0.3s, transform 0.2s;
        border: 2px solid #ddd;
    }
    
    .stepper-step.active .stepper-circle {
        background-color: #068b18; /* Hijau */
        border-color: #046e12;
        transform: scale(1.1);
        box-shadow: 0 4px 8px rgba(6, 139, 24, 0.3);
    }

    .stepper-step.active span {
        font-weight: 600;
        color: #333;
    }
    
    .stepper-step.done .stepper-circle {
        background-color: #068b18; /* Hijau */
        border-color: #046e12;
    }

    /* === Order Card === */
    .order-card {
        background-color: #ffffff;
        border: 1px solid #ff6347;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    
    .order-summary, .item-list {
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
    }
    
    .order-summary p {
        margin: 5px 0;
        display: flex;
        justify-content: space-between;
    }
    
    .order-summary span {
        font-weight: 600;
    }

    .order-item {
        display: flex;
        justify-content: space-between;
        margin: 5px 0;
        font-size: 0.9em;
        color: #555;
    }
    
    .order-total {
        font-size: 1.5em;
        font-weight: 700;
        color: #ff6347;
        text-align: right;
        margin-top: 15px;
    }
    
    .alert-box {
        text-align: center;
        padding: 20px;
        background-color: #fff3cd;
        color: #856404;
        border: 1px solid #ffeeba;
        border-radius: 5px;
    }
    
  </style>
</head>
<body>
  <header class="navbar">
    <div class="nav-left">
      <span class="brand-name">Pantry</span>
      <img src="Pantry Primary Logo-01.png" alt="Pantry Logo" class="brand-logo"> 
    </div>
    <div class="nav-right">
      <button class="nav-btn btn-secondary" onclick="window.location.href='index.html'">Kembali ke Menu</button>
      <button class="nav-btn btn-primary" onclick="window.location.href='payment_dashboard.html'">Dashboard Kasir</button>
    </div>
  </header>
  
  <div class="container">
    <h1>Status Pesanan Anda</h1>
    
    <div class="status-stepper">
        <div class="stepper-line"></div>
        <div class="stepper-step" id="step-Baru">
            <div class="stepper-circle">1</div>
            <span>Pesanan Baru</span>
        </div>
        <div class="stepper-step" id="step-Diproses">
            <div class="stepper-circle">2</div>
            <span>Diproses Dapur</span>
        </div>
        <div class="stepper-step" id="step-Selesai">
            <div class="stepper-circle">3</div>
            <span>Siap Diambil</span>
        </div>
    </div>

    <div id="order-details-container">
        <div class="alert-box">
            <p id="alert-message">Memuat status pesanan...</p>
        </div>
    </div>
  </div>

  <footer>
    © 2025 Pantry — Dibuat dengan ❤️
  </footer>

  <script>
    // Fungsi utilitas untuk memformat harga
    function formatRupiah(number) {
        return `Rp${number.toLocaleString('id-ID')}`;
    }

    function loadOrderStatus() {
        const lastOrderId = localStorage.getItem('pantryLastOrderId');
        const orders = JSON.parse(localStorage.getItem('pantryOrders')) || [];
        const order = orders.find(o => o.id == lastOrderId);
        const container = document.getElementById('order-details-container');
        const alertMessage = document.getElementById('alert-message');

        if (!lastOrderId || !order) {
            alertMessage.textContent = "Anda belum memiliki pesanan aktif. Silakan pesan dari halaman Menu.";
            return;
        }

        // 1. Render Detail Pesanan
        let itemsListHtml = '';
        order.items.forEach(item => {
            itemsListHtml += `
                <div class="order-item">
                    <span>${item.name} (x${item.qty})</span>
                    <span>${formatRupiah(item.price * item.qty)}</span>
                </div>
            `;
        });

        container.innerHTML = `
            <div class="order-card">
                <h2>ID Pesanan: <span style="color: #ff6347;">#${order.id.toString().slice(-6)}</span></h2>
                <div class="order-summary">
                    <p>Nama Pelanggan: <span>${order.customerName}</span></p>
                    <p>Waktu Pesan: <span>${order.time}</span></p>
                    <p>Status Pembayaran: <span style="color: #068b18;">Lunas</span></p>
                </div>
                
                <h3>Daftar Item:</h3>
                <div class="item-list">
                    ${itemsListHtml}
                </div>
                
                <p class="order-total">Total Bayar: ${formatRupiah(order.total)}</p>
            </div>
        `;

        // 2. Update Status Stepper
        const statuses = ['Baru', 'Diproses', 'Selesai'];
        let currentStatusFound = false;

        statuses.forEach(status => {
            const stepEl = document.getElementById(`step-${status}`);
            
            // Tandai langkah yang sudah selesai (Done)
            if (currentStatusFound) {
                stepEl.classList.remove('active');
            } else if (order.status === status) {
                // Tandai langkah saat ini (Active)
                stepEl.classList.add('active');
                stepEl.classList.remove('done');
                currentStatusFound = true; 
            } else if (!currentStatusFound) {
                // Tandai langkah yang sudah dilalui
                stepEl.classList.add('done');
            } else {
                // Langkah yang belum dilalui
                stepEl.classList.remove('active', 'done');
            }
        });
    }

    // Panggil fungsi saat halaman dimuat
    document.addEventListener('DOMContentLoaded', loadOrderStatus);
  </script>

</body>
</html>
