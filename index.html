<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantry - Pemesanan Online</title>
  <link rel="stylesheet" href="index.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="navbar">
    <div class="nav-left">
      <span class="brand-name">Pantry</span>
      <img src="Pantry Primary Logo-01.png" alt="Pantry Logo" class="brand-logo"> 
    </div>
    <div class="nav-right">
      <button class="nav-btn btn-secondary" onclick="openModal('contact')">Contact Me</button>
      <button class="nav-btn btn-secondary" onclick="window.location.href='order_status.html'">Cek Status Pesanan</button>
      <button class="nav-btn btn-primary" onclick="redirectToCashier()">Dashboard Kasir</button>
    </div>
  </header>
  
  <div class="container">
    <div class="content-grid">
        
        <div id="menu-section">
            <h2>Menu Makanan</h2>
            <div class="menu-list" id="menu-makanan"></div>

            <h2 style="margin-top: 30px;">Menu Minuman</h2>
            <div class="menu-list" id="menu-minuman"></div>
        </div>

        <div id="cart-section">
            <div class="cart-box">
                <h2>üõí Keranjang Anda</h2>
                <div id="cart-list">
                    <p style="text-align: center; color: #999;">Keranjang kosong.</p>
                </div>
                
                <hr>
                <div class="cart-summary">
                    <p>Total Item: <span id="total-items">0</span></p>
                    <p class="total-price">Total Bayar: <span id="total-price">Rp0</span></p>
                </div>

                <div class="payment-area">
                    <h3 style="margin-top: 20px;">Pembayaran</h3>
                    <input type="text" id="customer-name" placeholder="Masukkan Nama Anda" required style="margin-bottom: 10px;">
                    <select id="payment-method" style="margin-bottom: 10px;">
                        <option value="Tunai/Langsung">Tunai/Langsung</option>
                        <option value="Transfer Bank">Transfer Bank</option>
                        <option value="E-Wallet">E-Wallet (OVO/Dana/Gopay)</option>
                    </select>
                    <button class="btn-primary" onclick="initiatePayment()" style="width: 100%;">Bayar Sekarang</button>
                    <p style="margin-top: 10px; font-weight: 600;">Status Pembayaran: <span id="payment-status" style="color: #d14838;">Belum dibayar ‚ùå</span></p>
                </div>

                <button class="btn-primary" onclick="placeOrder()" style="width: 100%; margin-top: 20px; background-color: #068b18;">Pesan Sekarang</button>
                <button class="btn-secondary" onclick="clearCart()" style="width: 100%; margin-top: 10px; background-color: #999;">Kosongkan Keranjang</button>
            </div>
        </div>
    </div>
  </div>

  <div id="contact-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('contact')">&times;</span>
      <h2>Kontak Kami</h2>
      <p>Jika ada pertanyaan atau masalah dengan pesanan, silakan hubungi kasir atau hubungi kami di:</p>
      <p>Telepon: (021) 123-456</p>
      <p>Email: support@pantry.com</p>
      <p style="margin-top: 15px; font-style: italic;">"Melayani dengan rasa dan cinta."</p>
    </div>
  </div>

  <footer>
    ¬© 2025 Pantry ‚Äî Dibuat dengan ‚ù§Ô∏è
  </footer>

  <script>
    // Data dummy untuk menu
    const menuItems = [
      { id: 1, name: "Nasi Goreng Spesial", price: 25000, category: "makanan" },
      { id: 2, name: "Mie Ayam Bakso", price: 22000, category: "makanan" },
      { id: 3, name: "Ayam Geprek Sambal Matah", price: 28000, category: "makanan" },
      { id: 4, name: "Kopi Susu Gula Aren", price: 18000, category: "minuman" },
      { id: 5, name: "Es Teh Manis Jumbo", price: 8000, category: "minuman" },
      { id: 6, name: "Jus Alpukat", price: 20000, category: "minuman" },
    ];

    let cart = [];
    let currentPayment = null;

    // Inisialisasi
    document.addEventListener('DOMContentLoaded', () => {
        // Coba muat keranjang dari session storage (jika ada)
        const storedCart = sessionStorage.getItem('pantryCart');
        if (storedCart) {
            cart = JSON.parse(storedCart);
        }
        const storedPayment = sessionStorage.getItem('pantryCurrentPayment');
        if (storedPayment) {
            currentPayment = JSON.parse(storedPayment);
            document.getElementById('payment-status').textContent = `Menunggu Verifikasi (${currentPayment.method}) ‚è≥`;
            document.getElementById('payment-status').style.color = '#f7b000';
        }
        
        renderMenu();
        updateCart();
    });

    // Fungsi utilitas untuk memformat harga
    function formatRupiah(number) {
        return `Rp${number.toLocaleString('id-ID')}`;
    }

    function renderMenu() {
      const menuMakananEl = document.getElementById('menu-makanan');
      const menuMinumanEl = document.getElementById('menu-minuman');
      
      menuMakananEl.innerHTML = '';
      menuMinumanEl.innerHTML = '';

      menuItems.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'menu-item';
        itemEl.innerHTML = `
          <div class="item-info">
            <h3>${item.name}</h3>
            <p>${formatRupiah(item.price)}</p>
          </div>
          <button onclick="addToCart(${item.id})">Tambah +</button>
        `;
        
        if (item.category === 'makanan') {
          menuMakananEl.appendChild(itemEl);
        } else {
          menuMinumanEl.appendChild(itemEl);
        }
      });
    }

    function addToCart(itemId) {
        if (currentPayment) {
            alert("Anda sedang menunggu verifikasi pembayaran. Selesaikan pembayaran dahulu!");
            return;
        }
        const item = menuItems.find(i => i.id === itemId);
        const existingItem = cart.find(i => i.id === itemId);

        if (existingItem) {
            existingItem.qty += 1;
        } else {
            cart.push({ ...item, qty: 1 });
        }
        sessionStorage.setItem('pantryCart', JSON.stringify(cart));
        updateCart();
    }

    function updateCart() {
      const cartListEl = document.getElementById('cart-list');
      const totalItemsEl = document.getElementById('total-items');
      const totalPriceEl = document.getElementById('total-price');

      cartListEl.innerHTML = '';
      let totalItems = 0;
      let totalPrice = 0;

      if (cart.length === 0) {
        cartListEl.innerHTML = '<p style="text-align: center; color: #999;">Keranjang kosong.</p>';
      } else {
        cart.forEach(item => {
          const itemTotal = item.price * item.qty;
          totalItems += item.qty;
          totalPrice += itemTotal;

          const itemEl = document.createElement('div');
          itemEl.className = 'cart-item';
          itemEl.innerHTML = `
            <span>${item.name}</span>
            <div class="item-controls">
                <button onclick="changeQty(${item.id}, -1)">-</button>
                <span>${item.qty}</span>
                <button onclick="changeQty(${item.id}, 1)">+</button>
            </div>
            <span>${formatRupiah(itemTotal)}</span>
          `;
          cartListEl.appendChild(itemEl);
        });
      }

      totalItemsEl.textContent = totalItems;
      totalPriceEl.textContent = formatRupiah(totalPrice);
    }
    
    function changeQty(itemId, delta) {
        const item = cart.find(i => i.id === itemId);
        if (!item) return;

        item.qty += delta;

        if (item.qty <= 0) {
            cart = cart.filter(i => i.id !== itemId);
        }
        sessionStorage.setItem('pantryCart', JSON.stringify(cart));
        updateCart();
    }

    function clearCart() {
        if (confirm("Yakin ingin mengosongkan keranjang dan membatalkan pembayaran saat ini?")) {
            cart = [];
            currentPayment = null;
            sessionStorage.removeItem('pantryCart');
            sessionStorage.removeItem('pantryCurrentPayment');
            updateCart();
            document.getElementById('payment-status').textContent = "Belum dibayar ‚ùå";
            document.getElementById('payment-status').style.color = '#d14838';
        }
    }

    function initiatePayment() {
        if (cart.length === 0) return alert("Keranjang kosong! Tambahkan menu terlebih dahulu.");
        
        const totalAmount = cart.reduce((s, i) => s + i.price * i.qty, 0);
        const method = document.getElementById('payment-method').value;
        
        // Buat ID pembayaran unik (untuk verifikasi kasir)
        const paymentId = 'PAY-' + Date.now().toString().slice(-6); 

        currentPayment = {
            id: paymentId,
            total: totalAmount,
            method: method,
            time: new Date().toLocaleString('id-ID'),
            customerName: document.getElementById('customer-name').value.trim() || 'Anonim',
            cart: [...cart],
            status: 'pending' 
        };

        let payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
        payments.unshift(currentPayment);
        localStorage.setItem('pantryPayments', JSON.stringify(payments));
        sessionStorage.setItem('pantryCurrentPayment', JSON.stringify(currentPayment));

        document.getElementById('payment-status').textContent = `Menunggu Verifikasi (${method}): Kode ${paymentId} ‚è≥`;
        document.getElementById('payment-status').style.color = '#f7b000';
        
        alert(`Pembayaran telah dibuat! Total ${formatRupiah(totalAmount)} melalui ${method}. Mohon infokan kode ${paymentId} ke Kasir untuk Verifikasi.`);
    }

    // Fungsi yang akan dijalankan saat tombol "Pesan Sekarang" ditekan
    function placeOrder() {
      if (cart.length === 0) return alert("Keranjang kosong!");
      if (!currentPayment) return alert("Pilih metode pembayaran dan bayar terlebih dahulu!");

      // Cek status pembayaran
      const payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
      const found = payments.find(p => p.id === currentPayment.id);
      
      // PERUBAHAN: Pastikan status PAID
      if (!found || found.status !== "paid") return alert("Pembayaran belum diverifikasi oleh kasir! Mohon tunggu verifikasi atau hubungi kasir.");

      const name = document.getElementById('customer-name').value.trim();
      if (!name) return alert("Masukkan nama Anda!");

      // Buat ID pesanan unik
      const newOrderId = Date.now();

      const order = {
        id: newOrderId,
        customerName: name,
        items: [...cart],
        total: cart.reduce((s, i) => s + i.price * i.qty, 0),
        status: 'Baru',
        time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
        paymentId: currentPayment.id
      };

      const orders = JSON.parse(localStorage.getItem('pantryOrders')) || [];
      orders.unshift(order);
      localStorage.setItem('pantryOrders', JSON.stringify(orders));

      // 1. Simpan ID pesanan terakhir
      localStorage.setItem('pantryLastOrderId', newOrderId); 
      
      // 2. Kosongkan keranjang dan reset pembayaran
      cart = [];
      currentPayment = null;
      sessionStorage.removeItem('pantryCart');
      sessionStorage.removeItem('pantryCurrentPayment');
      updateCart();
      renderMenu();
      document.getElementById('payment-status').textContent = "Belum dibayar ‚ùå";
      
      // 3. Alihkan pelanggan ke halaman status pesanan
      alert(`‚úÖ Pesanan ${name} berhasil dibuat! Anda akan dialihkan ke halaman status pesanan.`);
      window.location.href = 'order_status.html';
    }

    // Fungsi Navigasi
    function redirectToCashier() {
      window.location.href = 'payment_dashboard.html';
    }
    
    // Fungsi Modal
    function openModal(id) { document.getElementById(id + "-modal").style.display = "block"; }
    function closeModal(id) { document.getElementById(id + "-modal").style.display = "none"; }
    window.onclick = function(event) {
      if (event.target.classList.contains('modal')) {
        event.target.style.display = "none";
      }
    }
  </script>

</body>
</html>
