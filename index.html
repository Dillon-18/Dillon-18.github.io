<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantry - Pemesanan Online</title>
  <link rel="stylesheet" href="index.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="navbar">
    <div class="nav-left">
      <span class="brand-name">Pantry</span>
      <img src="Pantry Primary Logo-01.png" alt="Pantry Logo" class="brand-logo"> 
    </div>
    <div class="nav-right">
      <button class="nav-btn btn-secondary" onclick="openModal('contact')">Contact Me</button>
      <button class="nav-btn btn-secondary" onclick="openModal('info')">Info</button>
      <button class="nav-btn btn-primary" onclick="redirectToCashier()">Dashboard Kasir</button>
    </div>
  </header>
  
  <div class="container">
    <div class="content-grid">
        
        <div id="menu-section">
            <h2>Menu Makanan</h2>
            <div class="menu-list" id="menu-makanan"></div>

            <h2 style="margin-top: 40px;">Menu Minuman</h2>
            <div class="menu-list" id="menu-minuman"></div>
        </div>

        <div id="sticky-sidebar">
            <div class="customer-info">
                <label for="customer-name" class="desktop-only" style="font-weight: 600;">Nama Pelanggan:</label>
                <label for="customer-name" class="mobile-only" style="font-weight: 600;">Pilihan Device / Nama Pelanggan:</label>
                <input type="text" id="customer-name" placeholder="cth: Meja 5 / Handphone Dilan" required>
            </div>
            
            <div id="cart">
                <div class="desktop-only">
                    <h3>Keranjang Pesanan</h3>
                    <ul id="cart-items" style="list-style: none; padding: 0;">
                        <li style="color: #999; text-align: center;">Keranjang kosong.</li>
                    </ul>
                    <hr>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <p style="font-weight: 600;">Total Harga:</p>
                        <p id="desktop-cart-total" style="font-weight: 700; color: #ff6347;">Rp0</p>
                    </div>
                </div>

                <button id="view-cart-details-btn" onclick="openModal('cart-details')" style="flex-grow: 1; border: none; background: none; text-align: left; padding: 0; cursor: pointer; display: none;">
                    <div id="mobile-summary" class="cart-summary" style="margin-right: 15px;">
                        <p id="mobile-cart-total" style="margin: 0; font-weight: 700; color: #333;">Total: Rp0</p>
                        <p id="mobile-payment-status" style="margin: 0; font-size: 0.8em; color: #ff6347;">Belum dibayar</p>
                    </div>
                </button>
                
                <button id="checkout-btn" onclick="checkout()" disabled>Pesan</button>
            </div>
        </div>

    </div>
  </div>

  <div id="payment-modal" class="modal">
    <div class="modal-content" style="text-align:center;">
      <span class="close" onclick="closeModal('payment')">&times;</span>
      <h2>Pilih Metode Pembayaran</h2>
      <p style="margin-bottom: 20px;">Silakan pilih metode pembayaran Anda:</p>
      
      <div style="display: flex; flex-direction: column; gap: 15px;">
        <button class="btn-primary" onclick="processPayment('QRIS')">QRIS (Scan Barcode)</button>
        <button class="btn-secondary" onclick="processPayment('Cash')">Bayar Tunai (Cashier)</button>
      </div>

      <div id="payment-status-section" style="margin-top: 30px; padding: 15px; border-radius: 8px; border: 1px solid #ddd; display: none;">
        <p id="payment-status-message" style="font-weight: 600; color: #333; margin-bottom: 10px;">Status Pembayaran:</p>
        <p id="payment-method-display" style="font-size: 0.9em; margin-bottom: 10px;"></p>
        <button id="pay-btn" class="btn-primary" onclick="startPaymentProcess()" disabled>Bayar Sekarang</button>
        <button id="cancel-payment-btn" class="btn-secondary" onclick="cancelPayment()" style="margin-left: 10px;">Batalkan</button>
      </div>
    </div>
  </div>

  <div id="cart-details-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('cart-details')">&times;</span>
      <h2>Detail Keranjang Pesanan</h2>
      <ul id="modal-cart-items" style="list-style: none; padding: 0;">
        </ul>
      <div style="border-top: 1px solid #eee; padding-top: 10px; margin-top: 15px; display: flex; justify-content: space-between;">
        <p style="font-weight: 600;">Total Harga:</p>
        <p id="modal-cart-total" style="font-weight: 700; font-size: 1.2em; color: #ff6347;">Rp0</p>
      </div>
      <button class="btn-primary" onclick="closeModal('cart-details')">Lanjutkan Pesanan</button>
    </div>
  </div>

  <div id="contact-modal" class="modal">
    <div class="modal-content"><span class="close" onclick="closeModal('contact')">&times;</span><h2>Contact Me</h2><p>Pantry - Pemesanan Online v1.0<br>Hubungi: developer@pantry.com</p></div>
  </div>
  <div id="info-modal" class="modal">
    <div class="modal-content"><span class="close" onclick="closeModal('info')">&times;</span><h2>Info</h2><p>Sistem ini untuk demonstrasi.</p></div>
  </div>
  

  <script>
    let currentCart = JSON.parse(localStorage.getItem('currentCart')) || [];
    let currentTotal = 0;
    let currentPayment = JSON.parse(localStorage.getItem('currentPayment')) || null;

    // --- Data Menu (Disederhanakan) ---
    const menuData = [
        { id: 1, name: 'Nasi Goreng Spesial', price: 25000, type: 'makanan' },
        { id: 2, name: 'Mie Ayam Bakso', price: 22000, type: 'makanan' },
        { id: 3, name: 'Es Teh Manis', price: 5000, type: 'minuman' },
        { id: 4, name: 'Kopi Susu Panas', price: 12000, type: 'minuman' },
    ];

    // --- Fungsi Helper ---
    function formatRupiah(number) {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
    }
    
    function redirectToCashier() {
        window.location.href = 'cashier.html';
    }

    // --- Logika Menu dan Keranjang ---
    function renderMenu() {
        const menuMakanan = document.getElementById('menu-makanan');
        const menuMinuman = document.getElementById('menu-minuman');
        
        menuMakanan.innerHTML = '';
        menuMinuman.innerHTML = '';

        menuData.forEach(item => {
            const div = document.createElement('div');
            div.className = 'menu-item';
            div.innerHTML = `
                <div class="item-details">
                    <p class="item-name">${item.name}</p>
                    <p class="item-price">${formatRupiah(item.price)}</p>
                </div>
                <button class="add-to-cart-btn" onclick="addToCart(${item.id})">Tambah</button>
            `;
            
            if (item.type === 'makanan') {
                menuMakanan.appendChild(div);
            } else if (item.type === 'minuman') {
                menuMinuman.appendChild(div);
            }
        });
    }

    function addToCart(id) {
        const item = menuData.find(i => i.id === id);
        if (!item) return;

        const existingItem = currentCart.find(i => i.id === id);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            currentCart.push({ 
                id: item.id, 
                name: item.name, 
                price: item.price, 
                quantity: 1 
            });
        }
        
        localStorage.setItem('currentCart', JSON.stringify(currentCart));
        updateCartDisplay(currentCart);
    }

    /**
     * FUNGSI MODIFIKASI INTI: Mengupdate tampilan keranjang (desktop, mobile summary, dan mobile modal)
     */
    function updateCartDisplay(cart) {
        const cartItemsList = document.getElementById('cart-items');
        const desktopTotal = document.getElementById('desktop-cart-total');
        const mobileTotal = document.getElementById('mobile-cart-total');
        const checkoutBtn = document.getElementById('checkout-btn');
        const payBtn = document.getElementById('pay-btn');
        const viewCartBtn = document.getElementById('view-cart-details-btn'); 
        
        // Elemen Modal Baru
        const modalCartItemsList = document.getElementById('modal-cart-items');
        const modalCartTotal = document.getElementById('modal-cart-total');
        
        cartItemsList.innerHTML = '';
        modalCartItemsList.innerHTML = ''; // Clear modal list
        let total = 0;

        if (cart.length === 0) {
            cartItemsList.innerHTML = '<li style="color: #999; text-align: center;">Keranjang kosong.</li>';
            desktopTotal.textContent = 'Rp0';
            mobileTotal.textContent = 'Total: Rp0';
            modalCartTotal.textContent = 'Rp0'; // Update modal total
            checkoutBtn.disabled = true;
            if (payBtn) payBtn.disabled = true;
            viewCartBtn.style.display = 'none'; // Sembunyikan tombol keranjang mobile
        } else {
            viewCartBtn.style.display = 'flex'; // Tampilkan tombol keranjang mobile
            
            cart.forEach(item => {
                const subtotal = item.price * item.quantity;
                
                // Elemen List Desktop
                const li = document.createElement('li');
                li.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; font-size:0.95em;">
                        <span>${item.name} (${item.quantity}x)</span>
                        <span style="font-weight:600;">${formatRupiah(subtotal)}</span>
                    </div>
                `;
                cartItemsList.appendChild(li);

                // Elemen List Modal (untuk mobile)
                const modalLi = li.cloneNode(true);
                modalCartItemsList.appendChild(modalLi);

                total += subtotal;
            });

            desktopTotal.textContent = formatRupiah(total);
            mobileTotal.textContent = `Total: ${formatRupiah(total)}`;
            modalCartTotal.textContent = formatRupiah(total); // Update modal total

            checkoutBtn.disabled = false;
            if (payBtn) payBtn.disabled = false;
        }
        
        currentCart = cart;
        currentTotal = total;
        updatePaymentStatusDisplay();
    }

    // --- Logika Pembayaran (disisakan yang penting) ---

    function updatePaymentStatusDisplay() {
        const mobileStatus = document.getElementById('mobile-payment-status');
        const paymentStatusSection = document.getElementById('payment-status-section');
        const paymentMethodDisplay = document.getElementById('payment-method-display');
        const payBtn = document.getElementById('pay-btn');
        const checkoutBtn = document.getElementById('checkout-btn');

        if (currentPayment && currentPayment.status === 'pending') {
            mobileStatus.textContent = currentPayment.method === 'Cash' ? 'Cashier' : 'Pending';
            mobileStatus.style.color = currentPayment.method === 'Cash' ? '#ff6347' : '#ff6347';
            
            // Logika tombol Pesan
            checkoutBtn.disabled = true;

            // Logika Modal
            if (paymentStatusSection) paymentStatusSection.style.display = 'block';
            if (paymentMethodDisplay) paymentMethodDisplay.textContent = `Metode: ${currentPayment.method}`;
            if (payBtn) payBtn.disabled = false;
        } else if (currentPayment && currentPayment.status === 'paid') {
            mobileStatus.textContent = 'Lunas';
            mobileStatus.style.color = '#068b18'; 
            
            // Logika tombol Pesan
            checkoutBtn.disabled = false;

            // Logika Modal
            if (paymentStatusSection) paymentStatusSection.style.display = 'none';
        } else {
            mobileStatus.textContent = 'Belum dibayar';
            mobileStatus.style.color = '#ff6347';
            
            // Logika tombol Pesan
            checkoutBtn.disabled = true; 

            // Logika Modal
            if (paymentStatusSection) paymentStatusSection.style.display = 'none';
        }
    }

    // --- Logika Checkout dan Modal ---
    function checkout() {
      if (!currentPayment || currentPayment.status !== 'paid') {
          return alert("⚠️ Harap selesaikan pembayaran terlebih dahulu (status harus 'Lunas').");
      }

      const nameInput = document.getElementById('customer-name');
      const name = nameInput.value.trim();
      if (!name) return alert("Masukkan nama Anda!");

      const finalCart = currentPayment.cart; 
      
      const newOrderId = Date.now(); 
      const order = {
        id: newOrderId,
        customerName: name, 
        items: finalCart, 
        total: currentPayment.total, 
        status: 'Baru', 
        time: new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
        paymentId: currentPayment.id 
      };

      const orders = JSON.parse(localStorage.getItem('pantryOrders')) || [];
      orders.unshift(order);
      localStorage.setItem('pantryOrders', JSON.stringify(orders)); 

      let payments = JSON.parse(localStorage.getItem('pantryPayments')) || [];
      payments = payments.filter(p => p.id !== currentPayment.id);
      localStorage.setItem('pantryPayments', JSON.stringify(payments));

      // Reset
      localStorage.removeItem('currentCart');
      localStorage.removeItem('currentPayment');
      currentCart = [];
      currentPayment = null;
      updateCartDisplay(currentCart);

      alert(`✅ Pesanan ${name} berhasil dibuat! Anda akan dialihkan ke halaman status pesanan.`);
      
      window.location.href = `order_status.html?orderId=${newOrderId}`;
    }

    function openModal(t) { document.getElementById(t + "-modal").style.display = "block"; }
    function closeModal(t) { document.getElementById(t + "-modal").style.display = "none"; }

    // --- Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        renderMenu();
        updateCartDisplay(currentCart);
        // Menutup modal saat klik di luar area modal
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            });
        }

        // Perbarui status pembayaran jika ada perubahan dari dashboard
        window.addEventListener('storage', () => {
            currentPayment = JSON.parse(localStorage.getItem('currentPayment')) || null;
            updatePaymentStatusDisplay();
        });
    });
  </script>
</body>
</html>
